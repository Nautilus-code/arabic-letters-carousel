<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Карусель арабских букв</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            background: #f9f9f9;
            padding: 20px;
            direction: rtl;
            margin: 0;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .carousel {
            background: white;
            padding: 40px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
            min-height: 240px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .letter-name {
            font-size: 30px;
            margin-bottom: 20px;
            color: rgb(46, 204, 113);
            font-weight: 600;
        }

        .forms {
            font-size: 48px;
            line-height: 1.6;
            direction: ltr;
            text-align: center;
            font-weight: bold;
            white-space: pre-line;
        }

        .initial {
            color: #2980b9;
        }

        .medial {
            color: #e74c3c;
        }

        .final {
            color: #2980b9;
        }

        .nav-buttons {
            margin-top: 25px;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px;
            font-size: 0;
            cursor: pointer;
            border-radius: 8px;
            margin: 0 6px;
            transition: background 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
        }

        .btn:hover {
            background: #2980b9;
        }

        .btn.auto-on {
            background: #2ecc71;
        }

        .btn.auto-on:hover {
            background: #27ae60;
        }

        .btn.auto-off {
            background: #e74c3c;
        }

        .btn.auto-off:hover {
            background: #c0392b;
        }

        .counter {
            margin-top: 15px;
            color: #7f8c8d;
            font-size: 16px;
        }

        .btn svg {
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Карусель арабских букв</h1>

        <div class="carousel" id="carousel">
            <div class="letter-name" id="letterName">Ба</div>
            <div class="forms" id="forms">بَ بِ بُ
                بَـ ـبِـ ـبُ
                بَبِبُ</div>
        </div>

        <div class="nav-buttons">
            <!-- Кнопка "Вперёд" -->
            <button class="btn" id="next" aria-label="Следующая буква">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="9,18 15,12 9,6"></polyline>
                </svg>
            </button>

            <!-- Кнопка звука -->
            <button class="btn" id="audioBtn" aria-label="Воспроизвести звук">
                <svg class="icon-play-sound" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="11,5 6,9 2,9 2,15 6,15 11,19 11,5"></polygon>
                    <path d="M15.54,8.46a5,5,0,0 1,0,7.07"></path>
                    <path d="M19.07,4.93a10,10,0,0 1,0,14.14"></path>
                </svg>
                <svg class="icon-stop-sound" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" style="display: none;">
                    <rect x="6" y="6" width="12" height="12"></rect>
                </svg>
            </button>

            <!-- Кнопка "Авто-воспроизведение" -->
            <button class="btn auto-on" id="playBtn" aria-label="Авто-проигрывание">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="5,3 19,12 5,21 5,3"></polygon>
                </svg>
            </button>

            <!-- Кнопка "Стоп" -->
            <button class="btn auto-off" id="stopBtn" style="display: none;" aria-label="Остановить">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <rect x="6" y="6" width="12" height="12"></rect>
                </svg>
            </button>

            <!-- Кнопка "Назад" -->
            <button class="btn" id="prev" aria-label="Предыдущая буква">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="15,18 9,12 15,6"></polyline>
                </svg>
            </button>
        </div>

        <div class="counter" id="counter">1 / 28</div>
    </div>

    <script>
        const letters = [
            ['ا', 'Алиф'],
            ['ب', 'Ба'],
            ['ت', 'Та'],
            ['ث', 'Са'],
            ['ج', 'Джим'],
            ['ح', 'Хьа'],
            ['خ', 'Хо'],
            ['د', 'Даль'],
            ['ذ', 'Заль'],
            ['ر', 'Ро'],
            ['ز', 'За'],
            ['س', 'Син'],
            ['ش', 'Щин'],
            ['ص', 'Сод'],
            ['ض', 'ДIод'],
            ['ط', 'ТIо'],
            ['ظ', 'ЗIо'],
            ['ع', 'Iаин'],
            ['غ', 'ГIоин'],
            ['ف', 'Фа'],
            ['ق', 'Къоф'],
            ['ك', 'Каф'],
            ['ل', 'Лям'],
            ['م', 'Мим'],
            ['ن', 'Нун'],
            ['ه', 'ХIа'],
            ['و', 'Ваув'],
            ['ي', 'Йа']
        ];

        const carousel = document.getElementById('carousel');
        const letterNameEl = document.getElementById('letterName');
        const formsEl = document.getElementById('forms');
        const counterEl = document.getElementById('counter');
        const prevBtn = document.getElementById('prev');
        const nextBtn = document.getElementById('next');
        const playBtn = document.getElementById('playBtn');
        const stopBtn = document.getElementById('stopBtn');
        const audioBtn = document.getElementById('audioBtn');

        let currentIndex = 0;
        let autoPlayInterval = null;
        let isAutoMode = false;
        let currentAudio = null;

        const fatHa = '\u064E'; // ـَ
        const kasRa = '\u0650'; // ـِ
        const damMa = '\u064F'; // ـُ
        const tatweelChar = 'ـ';

        function getForms(letter) {
            const nonConnecting = ['د', 'ذ', 'ر', 'ز', 'و', 'ا'];
            const isNonConnecting = nonConnecting.includes(letter);

            const l1 = `${letter}${fatHa}  ${letter}${kasRa}  ${letter}${damMa}`;

            let initialForm, medialForm, finalForm;

            if (isNonConnecting) {
                initialForm = `${letter}${fatHa}`;
                medialForm = `${tatweelChar}${letter}${kasRa}`;
                finalForm = `${tatweelChar}${letter}${damMa}`;
            } else {
                initialForm = `${letter}${fatHa}${tatweelChar}`;
                medialForm = `ـ${letter}${kasRa}ـ`;
                finalForm = `ـ${letter}${damMa}`;
            }

            const l2 = `${initialForm}  ${medialForm}  ${finalForm}`;
            const l3 = `${letter}${fatHa}${letter}${kasRa}${letter}${damMa}`;

            return [l1, l2, l3].join('\n');
        }

        function toggleAudioIcon(isPlaying) {
            const playIcon = audioBtn.querySelector('.icon-play-sound');
            const stopIcon = audioBtn.querySelector('.icon-stop-sound');
            if (isPlaying) {
                playIcon.style.display = 'none';
                stopIcon.style.display = 'block';
            } else {
                playIcon.style.display = 'block';
                stopIcon.style.display = 'none';
            }
        }

        function updateSlide(index, playAudio = false) {
            const [letter, name] = letters[index];
            letterNameEl.textContent = name;

            const formsText = getForms(letter);
            let html = formsText
                .replace(new RegExp(letter + fatHa, 'g'), `<span class="initial">${letter + fatHa}</span>`)
                .replace(new RegExp(letter + kasRa, 'g'), `<span class="medial">${letter + kasRa}</span>`)
                .replace(new RegExp(letter + damMa, 'g'), `<span class="final">${letter + damMa}</span>`);

            formsEl.innerHTML = html;
            counterEl.textContent = `${index + 1} / ${letters.length}`;

            if (playAudio) {
                playAudioForIndex(index);
                if (!isAutoMode) {
                    toggleAudioIcon(true);
                }
            } else {
                if (!isAutoMode) {
                    toggleAudioIcon(false);
                }
            }
        }

        function playAudioForIndex(index) {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }

            const trackNumber = String(index + 1).padStart(2, '0');
            const audioPath = `sounds/track${trackNumber}.ogg`;

            currentAudio = new Audio(audioPath);
            currentAudio.onended = () => {
                currentAudio = null;
                if (!isAutoMode) {
                    toggleAudioIcon(false);
                }
            };

            currentAudio.play().catch(err => {
                console.error("Ошибка воспроизведения:", err);
            });
        }

        function nextSlide(playAudio = false) {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            currentIndex = (currentIndex + 1) % letters.length;
            updateSlide(currentIndex, playAudio);
        }

        function prevSlide() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            currentIndex = (currentIndex - 1 + letters.length) % letters.length;
            updateSlide(currentIndex);
        }

        function startAutoPlay() {
            isAutoMode = true;
            if (autoPlayInterval) clearInterval(autoPlayInterval);

            // Сбрасываем иконку звука: показываем только "динамик"
            toggleAudioIcon(false); // false = показать динамик

            // Воспроизводим текущую букву
            updateSlide(currentIndex, true);

            autoPlayInterval = setInterval(() => {
                nextSlide(true);
            }, 5000);

            playBtn.style.display = 'none';
            stopBtn.style.display = 'inline-block';
        }

        function stopAutoPlay() {
            isAutoMode = false;
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
            }
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            stopBtn.style.display = 'none';
            playBtn.style.display = 'inline-block';
            if (!isAutoMode) {
                toggleAudioIcon(false);
            }
        }

        audioBtn.addEventListener('click', () => {
            if (isAutoMode) return; // Игнорируем в авто-режиме

            if (currentAudio && !currentAudio.paused) {
                currentAudio.pause();
                currentAudio = null;
                toggleAudioIcon(false);
            } else {
                playAudioForIndex(currentIndex);
                toggleAudioIcon(true);
            }
        });

        playBtn.addEventListener('click', startAutoPlay);
        stopBtn.addEventListener('click', stopAutoPlay);

        prevBtn.addEventListener('click', () => {
            stopAutoPlay();
            prevSlide();
        });

        nextBtn.addEventListener('click', () => {
            stopAutoPlay();
            nextSlide();
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                stopAutoPlay();
                prevSlide();
            } else if (e.key === 'ArrowRight') {
                stopAutoPlay();
                nextSlide();
            }
        });

        // carousel.addEventListener('mouseenter', stopAutoPlay);

        updateSlide(currentIndex);
    </script>
</body>

</html>
